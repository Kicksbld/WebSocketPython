<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord - WebSocket Server</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Tableau de bord</h1>
                <span class="header-subtitle">Supervision en temps r√©el</span>
            </div>
            <div class="header-controls">
                <select class="env-select" id="envSelect">
                    <option value="dev">Dev (localhost)</option>
                    <option value="prod">Prod (192.168.4.230)</option>
                </select>
                <button class="btn btn-success" id="connectBtn">Connexion</button>
                <button class="btn btn-danger" id="disconnectBtn" disabled>D√©connexion</button>
            </div>
            <div class="connection-status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Hors ligne</span>
            </div>
        </header>

        <!-- Accent Line -->
        <div class="accent-line"></div>

        <!-- Main Content - Graph first -->
        <main class="main-content">
            <!-- Left: Network Graph (primary focus) -->
            <section class="graph-section">
                <div class="panel graph-panel">
                    <div class="panel-header">
                        <div class="panel-title-group">
                            <h2>R√©seau en direct</h2>
                            <span class="panel-subtitle">Glissez les n≈ìuds pour r√©organiser</span>
                        </div>
                        <div class="graph-legend">
                            <span class="legend-item">
                                <span class="legend-dot server"></span>
                                Serveur
                            </span>
                            <span class="legend-item">
                                <span class="legend-dot client"></span>
                                Client
                            </span>
                        </div>
                    </div>
                    <div id="networkGraph"></div>
                </div>
            </section>

            <!-- Right: Sidebar with clients + logs -->
            <aside class="sidebar">
                <!-- Connected Clients -->
                <div class="panel clients-panel">
                    <div class="panel-header">
                        <h2>Utilisateurs</h2>
                        <span class="client-badge" id="clientCount">0</span>
                    </div>
                    <div class="client-cards" id="clientCards">
                        <div class="empty-state">
                            <span class="empty-icon">üë•</span>
                            <span>Aucun utilisateur connect√©</span>
                        </div>
                    </div>
                </div>

                <!-- Communication Logs -->
                <div class="panel log-panel">
                    <div class="panel-header">
                        <h2>Activit√©</h2>
                        <button class="btn btn-icon" id="clearLog" title="Effacer l'historique">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                            </svg>
                        </button>
                    </div>
                    <div class="communication-log" id="communicationLog">
                        <div class="empty-state">
                            <span class="empty-icon">üì°</span>
                            <span>En attente de messages...</span>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const WS_URLS = {
            dev: "{{ ws_url_dev }}",
            prod: "{{ ws_url_prod }}"
        };
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
